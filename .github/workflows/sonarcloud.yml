on:
jobs:
 name: SonarCloud

 on:
   push:
     branches:
       - main
       - master
   pull_request:
     branches:
       - '*'

 jobs:
   sonarcloud:
     name: SonarCloud
     runs-on: ubuntu-latest
     steps:
       - name: Checkout code
         uses: actions/checkout@v4
         with:
           fetch-depth: 0
       - name: Setup .NET
         uses: actions/setup-dotnet@v4
         with:
           dotnet-version: '8.0.x'
       - name: Install SonarCloud Scanner
         run: dotnet tool install --global dotnet-sonarscanner
       - name: Restore dependencies
         run: dotnet restore zeferini-person-api-dotnet.slnx
       - name: Build
         run: dotnet build zeferini-person-api-dotnet.slnx --no-restore
       - name: Test
         run: dotnet test zeferini-person-api-dotnet.slnx --no-build --verbosity normal
       - name: Run SonarCloud analysis
         env:
           SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
         run: |
           dotnet sonarscanner begin /k:"zeferini-dev_zeferini-person-api-dotnet" /o:"zeferini-dev" /d:sonar.login="${{ secrets.SONAR_TOKEN }}"
           dotnet build zeferini-person-api-dotnet.slnx
           dotnet sonarscanner end /d:sonar.login="${{ secrets.SONAR_TOKEN }}"
